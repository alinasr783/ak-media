# Subscription Schema Notes

## Database Schema Differences

There appears to be a difference between the subscription schema defined in the project files and the actual database schema being used.

### Project Schema (database-schema.sql):
```sql
CREATE TABLE IF NOT EXISTS subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  clinic_id BIGINT NOT NULL,
  plan_id UUID REFERENCES plan_pricing(id) ON DELETE SET NULL,
  status TEXT NOT NULL DEFAULT 'active' CHECK (status IN ('active', 'cancelled', 'expired')),
  current_period_start TIMESTAMP WITH TIME ZONE NOT NULL,
  current_period_end TIMESTAMP WITH TIME ZONE NOT NULL,
  billing_period TEXT NOT NULL DEFAULT 'monthly' CHECK (billing_period IN ('monthly', 'annual')),
  amount DECIMAL(10, 2) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### Actual Database Schema (from user data):
```sql
create table public.subscriptions (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  plan_id text null,
  status text null default 'active'::text,
  current_period_start timestamp with time zone null,
  current_period_end timestamp with time zone null,
  payment_method text null,
  billing_period text null default 'monthly'::text,
  amount numeric(10, 2) null,
  clinic_id uuid null,
  constraint subscriptions_pkey primary key (id),
  constraint subscriptions_plan_id_fkey foreign KEY (plan_id) references plans (id),
  constraint subscriptions_billing_period_check check (
    (billing_period = any (array['monthly'::text, 'annual'::text]))
  )
) TABLESPACE pg_default;
```

## Key Differences:

1. **ID Field**: 
   - Project: UUID with default `gen_random_uuid()`
   - Actual: `bigint` with `generated by default as identity`

2. **Clinic ID**:
   - Project: `BIGINT NOT NULL`
   - Actual: `uuid null`

3. **Plan ID**:
   - Project: `UUID REFERENCES plan_pricing(id) ON DELETE SET NULL`
   - Actual: `text null`

4. **Constraints**:
   - Project: Strict NOT NULL constraints and status check
   - Actual: Most fields allow NULL values

5. **Additional Fields**:
   - Actual schema has `payment_method` field not present in project schema
   - Actual schema has `updated_at` field not present in actual schema

## Sample Data:
```json
[{
  "idx":2,
  "id":29,
  "created_at":"2025-12-12 23:23:54.437682+00",
  "plan_id":"premium",
  "status":"active",
  "current_period_start":"2025-12-12 23:23:54.117+00",
  "current_period_end":"2026-01-12 23:23:54.117+00",
  "payment_method":null,
  "billing_period":"monthly",
  "amount":"510.00",
  "clinic_id":"7cf3a2a3-ee02-4a21-934f-be27f0e20d8f"
}]
```

## Recommendations:

1. **For Consistency**: Update the project schema to match the actual database schema
2. **For Development**: Be aware of the nullable fields when querying
3. **For Subscription Creation**: The current implementation should work with the actual schema since it only sets the required fields

## SQL for Schema Alignment:
```sql
-- Update project schema to match actual database schema
ALTER TABLE subscriptions 
ALTER COLUMN id TYPE bigint,
ALTER COLUMN id SET DEFAULT nextval('subscriptions_id_seq');

ALTER TABLE subscriptions 
ALTER COLUMN clinic_id TYPE uuid USING clinic_id::uuid,
ALTER COLUMN clinic_id DROP NOT NULL;

ALTER TABLE subscriptions 
ALTER COLUMN plan_id TYPE text,
ALTER COLUMN plan_id DROP NOT NULL;

ALTER TABLE subscriptions 
ALTER COLUMN status DROP NOT NULL;

ALTER TABLE subscriptions 
ALTER COLUMN current_period_start DROP NOT NULL;

ALTER TABLE subscriptions 
ALTER COLUMN current_period_end DROP NOT NULL;

ALTER TABLE subscriptions 
ADD COLUMN IF NOT EXISTS payment_method text;

ALTER TABLE subscriptions 
ALTER COLUMN amount DROP NOT NULL;

-- Remove updated_at if not needed
ALTER TABLE subscriptions 
DROP COLUMN IF EXISTS updated_at;
```

Note: The above SQL is illustrative. In practice, significant schema changes like this would require careful migration planning.